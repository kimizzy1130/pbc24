import{a as V,b as Y,c as nn}from"./chunk-MKERJNYN.mjs";import{q as Q,t as D}from"./chunk-RNO5ZG3C.mjs";import{a as d}from"./chunk-XQIWF5HY.mjs";import{b as E,d as R,e as B,f as M}from"./chunk-NWRKJFHV.mjs";import{b as l,d as g,e as v}from"./chunk-ERWQOVBF.mjs";import{a as w,c as p,d as f}from"./chunk-WC2WSKYZ.mjs";import{c as L,d as H,e as X,f as z,g as Z,h as j,i as J}from"./chunk-OWZLBIDD.mjs";import{a as O}from"./chunk-QKTV6AZ7.mjs";import{a as k}from"./chunk-YGMT4GQ5.mjs";import{a as S}from"./chunk-2QV6HI3M.mjs";import{b as q}from"./chunk-A2QH4A6D.mjs";import{a as K}from"./chunk-AH44UPM4.mjs";import{a as _}from"./chunk-FBFMQZTM.mjs";import{a as h,c as P}from"./chunk-ZFIMVSCR.mjs";import{a as W,c as $}from"./chunk-I7WRJY7K.mjs";import{b as u}from"./chunk-F7CR75CJ.mjs";import{a as C}from"./chunk-DRF6AMEZ.mjs";import{c as F,d as N,g as U,h as x}from"./chunk-HHJBCGAQ.mjs";import{e as b}from"./chunk-77SKA4HT.mjs";import{b as G}from"./chunk-NL72WE3E.mjs";import{sha3_256 as on}from"@noble/hashes/sha3";async function Wn(n){if(Q(n))return cn(n);let{moduleAddress:e,moduleName:t,functionName:o}=D(n.function),a=await K(async()=>Y(e,t,o,n.aptosConfig),`entry-function-${n.aptosConfig.network}-${e}-${t}-${o}`,1e3*60*5)();return sn({abi:a,...n})}function sn(n){let e=n.abi,{moduleAddress:t,moduleName:o,functionName:a}=D(n.function),r=V(n.typeArguments);if(r.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${r.length}`);let i=n.functionArguments.map((s,A)=>nn(n.function,e,s,A,r));if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${a}', expected ${e.parameters.length} but got ${i.length}`);let c=z.build(`${t}::${o}`,a,r,i);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new X(new j(s,new J(c)))}return new H(c)}function cn(n){return new L(new Z(G.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function un(n){let{aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r}=n,i=b[e.network]?Promise.resolve({chain_id:b[e.network]}):C({aptosConfig:e}),c=a?.gasUnitPrice?Promise.resolve({gas_estimate:a.gasUnitPrice}):q({aptosConfig:e}),[{chain_id:s},{gas_estimate:A}]=await Promise.all([i,c]),y=a?.accountSequenceNumber!==void 0?Promise.resolve({sequence_number:a.accountSequenceNumber}):k({aptosConfig:e,accountAddress:t}),m;if(r&&u.from(r).equals(u.ZERO))try{let{sequence_number:T}=await y;m=T}catch{m="0"}else{let{sequence_number:T}=await y;m=T}let{maxGasAmount:en,gasUnitPrice:an,expireTimestamp:rn}={maxGasAmount:a?.maxGasAmount?BigInt(a.maxGasAmount):BigInt(F),gasUnitPrice:BigInt(A),expireTimestamp:BigInt(Math.floor(Date.now()/1e3)+N),...a};return new w(u.from(t),BigInt(m),o,BigInt(en),BigInt(an),BigInt(rn),new O(s))}async function $n(n){let{aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r}=n,i=await un({aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return{rawTransaction:i,secondarySignerAddresses:c,feePayerAddress:n.feePayerAddress?u.from(n.feePayerAddress):void 0}}return{rawTransaction:i,feePayerAddress:n.feePayerAddress?u.from(n.feePayerAddress):void 0}}function Cn(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:o,feePayerPublicKey:a}=n,r=I(e);if(t.feePayerAddress){let c=new f(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];o&&(s=o.map(m=>I(m)));let A=I(a),y=new B(r,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:A});return new d(c.raw_txn,y).bcsToBytes()}if(t.secondarySignerAddresses){let c=new p(t.rawTransaction,t.secondarySignerAddresses),s=[];s=o.map(y=>I(y));let A=new R(r,t.secondarySignerAddresses,s);return new d(c.raw_txn,A).bcsToBytes()}let i;if(r instanceof l)i=new E(r.public_key,r.signature);else if(r instanceof g)i=new M(r);else throw new Error("Invalid public key");return new d(t.rawTransaction,i).bcsToBytes()}function I(n){if(n instanceof _){if(n.publicKey instanceof h)return new g(n,new S(new P(new Uint8Array(64))));if(n.publicKey instanceof W)return new g(n,new S(new $(new Uint8Array(64))))}return new l(new h(n.toUint8Array()),new P(new Uint8Array(64)))}function Kn(n){let{signer:e,transaction:t}=n,o=An(t),a=e.sign(o);switch(e.signingScheme){case 0:return new l(new h(e.publicKey.toUint8Array()),new P(a.toUint8Array()));case 2:if(!_.isPublicKey(e.publicKey))throw new Error(`Cannot sign transaction, public key does not match ${e.signingScheme}`);return new g(e.publicKey,new S(a));default:throw new Error(`Cannot sign transaction, signing scheme ${e.signingScheme} not supported`)}}function kn(n){let{transaction:e,senderAuthenticator:t,feePayerAuthenticator:o,additionalSignersAuthenticators:a}=n,r=tn(e);if((o||a)&&(r instanceof p||r instanceof f))return dn(r,t,o,a);if(t instanceof l&&r instanceof w){let i=new E(t.public_key,t.signature);return new d(r,i).bcsToBytes()}if((t instanceof g||t instanceof v)&&r instanceof w){let i=new M(t);return new d(r,i).bcsToBytes()}throw new Error(`Cannot generate a signed transaction, ${t} is not a supported account authentication scheme`)}function tn(n){return n.feePayerAddress?new f(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new p(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function dn(n,e,t,o){if(n instanceof f){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");let a=new B(e,n.secondary_signer_addresses,o??[],{address:n.fee_payer_address,authenticator:t});return new d(n.raw_txn,a).bcsToBytes()}if(n instanceof p){if(!o)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");let a=new R(e,n.secondary_signer_addresses,o??[]);return new d(n.raw_txn,a).bcsToBytes()}throw new Error(`Cannot prepare multi signers transaction to submission, ${typeof n} transaction is not supported`)}function An(n){let e=tn(n),t=on.create();if(e instanceof w)t.update(U);else if(e instanceof p)t.update(x);else if(e instanceof f)t.update(x);else throw new Error(`Unknown transaction type to sign on: ${e}`);let o=t.digest(),a=e.bcsToBytes(),r=new Uint8Array(o.length+a.length);return r.set(o),r.set(a,o.length),r}export{Wn as a,sn as b,un as c,$n as d,Cn as e,I as f,Kn as g,kn as h,tn as i,dn as j,An as k};
//# sourceMappingURL=chunk-SZYATFM7.mjs.map